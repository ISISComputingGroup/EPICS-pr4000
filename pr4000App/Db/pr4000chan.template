# pr4000chan.template
#% macro, __doc__, Template database for a PR4000 Baratron gauge controller channel
# Ian Gillingham - December 2014
#
# substitutions:
#% macro, device, Device name
#% macro, port,   Asyn Port name, e.g. ty_40_0
#% macro, channel, Channel number
#
# Instantiate one of these for each channel (i.e. 2 off)
# e.g:
# file pr4000chan.template
#     {
#     pattern { device               ,  port   , channel }
#             { ${domain}-VA-GCTLR-10, "ts1_18", 1       }
#             { ${domain}-VA-GCTLR-10, "ts1_18", 2       }
#     }
#


# The :DISA record is essentially a development
# tool and not intended for use in the field.
#
record(bi, "$(device):CH$(channel):DISA")
    {
    field(DESC, "Channel Disable")
    field(VAL,  "0")
    field(ZNAM, "ENABLE")
    field(ONAM, "DISABLE")
    field(PINI,  "YES")
    }


#  Actual value % of FS formatted in selected range
#  -005.00 - 110.00
#
record(ai, "$(device):CH$(channel):AV")
{
    field(DESC, "Actual Value Readback")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol av($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    field(PREC, "2")
}
    
record(ao, "$(device):CH$(channel):SPSET")
    {
    field(DESC, "Setpoint Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol sp_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):SP")
    {
    field(DESC, "Setpoint")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol sp($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ai, "$(device):CH$(channel):EXTIN")
    {
    field(DESC, "External Input")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol extinp($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }


record(mbbi, "$(device):CH$(channel):VALVE")
    {
    field(DESC, "Valve status")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol valve($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }

record(mbbo, "$(device):CH$(channel):VALVE_SET")
    {
    field(DESC, "Valve Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol valve_set($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    }
    
record(mbbi, "$(device):CH$(channel):RELAY")
    {
    field(DESC, "Relay status")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol relay($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }

record(mbbo, "$(device):CH$(channel):RELAYSET")
    {
    field(DESC, "Relay Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol relay_set($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    }
    
record(ao, "$(device):CH$(channel):GAINSET")
    {
    field(DESC, "Gain Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol gain_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):GAIN")
    {
    field(DESC, "Gain")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol gain($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):OFFSETSET")
    {
    field(DESC, "Offset Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol offset_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):OFFSET")
    {
    field(DESC, "Offset")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol offset($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):RTDOFFSETSET")
    {
    field(DESC, "RTD Offset Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol rtdoffset_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):RTDOFFSET")
    {
    field(DESC, "RTD Offset")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol rtdoffset($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):AUTOZERO")
    {
    field(DESC, "Autozero")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol autozero($(channel)) $(port)")
    }

record(ao, "$(device):CH$(channel):INPRANGESET")
    {
    field(DESC, "Input Range Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol inputrange_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):INPUTRANGE")
    {
    field(DESC, "Input Range")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol inputrange($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):OUTPRANGESET")
    {
    field(DESC, "Output Range Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol outputrange_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):OUTPUTRANGE")
    {
    field(DESC, "Output Range")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol outputrange($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ai, "$(device):CH$(channel):EXTINPUTRANGE")
    {
    field(DESC, "External Input Range")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol extinputrange($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):EXTINPRANGESET")
    {
    field(DESC, "External Input Range Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol extinputrange_set($(channel)) $(port)")
    }

record(ao, "$(device):CH$(channel):EXTOUTPRANGESET")
    {
    field(DESC, "External Output Range Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol extoutputrange_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):EXTOUTPUTRANGE")
    {
    field(DESC, "External Output Range")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol extoutputrange($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(mbbi, "$(device):CH$(channel):SIGNALMODE")
    {
    field(DESC, "Signal Mode")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol signalmode($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "METER")
    field(ONVL, "1")
    field(ONST, "OFF")
    field(TWVL, "2")
    field(TWST, "INDEP")
    field(THVL, "3")
    field(THST, "EXTRN")
    field(FRVL, "4")
    field(FRST, "SLAVE")
    field(FVVL, "5")
    field(FVST, "RTD")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }

record(mbbo, "$(device):CH$(channel):SIGNALMODESET")
    {
    field(DESC, "Signal Mode Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol signalmode_set($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "METER")
    field(ONVL, "1")
    field(ONST, "OFF")
    field(TWVL, "2")
    field(TWST, "INDEP")
    field(THVL, "3")
    field(THST, "EXTRN")
    field(FRVL, "4")
    field(FRST, "SLAVE")
    field(FVVL, "5")
    field(FVST, "RTD")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }

record(ai, "$(device):CH$(channel):RANGESET")
    {
    field(DESC, "Range Set")
    field(FLNK, "$(device):CH$(channel):RGWRITE")
    }

record(ai, "$(device):CH$(channel):RANGE")
    {
    field(DESC, "Range")
    field(DTYP, "stream")
    field(VAL,  "0")
    field(INP,  "@pr4000.protocol readrange($(channel),$(device):CH$(channel):RANGEUNITS) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ai, "$(device):CH$(channel):RANGEUNITSSET")
    {
    field(DESC, "Range Units Set")
    field(DTYP, "Soft Channel")
    field(PINI, "YES")
    field(INP, "1")
    field(FLNK, "$(device):CH$(channel):RANGESET")
    }

record(ai, "$(device):CH$(channel):RANGEUNITS")
    {
    field(DESC, "Range Units")
    field(VAL, "0")
    field(PINI, "YES")
    }

record (calcout, "$(device):CH$(channel):RGWRITE") 
    {
    field (DTYP, "stream")
    field (INPA, "$(device):CH$(channel):RANGESET")
    field (INPB, "$(device):CH$(channel):RANGEUNITSSET")
    field (CALC, "0")
    field (OUT, "@pr4000.protocol writerange($(channel)) $(port)")
    } 

record(ao, "$(device):CH$(channel):SCALESET")
    {
    field(DESC, "Scale Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol scale_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):SCALE")
    {
    field(DESC, "Scale")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol scale($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(mbbi, "$(device):CH$(channel):LIMITMODE")
    {
    field(DESC, "Limit Mode")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol limitmode($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "SLEEP")
    field(ONVL, "1")
    field(ONST, "LIMIT")
    field(TWVL, "2")
    field(TWST, "BAND")
    field(THVL, "3")
    field(THST, "MLIMIT")
    field(FRVL, "4")
    field(FRST, "MBAND")
    field(FVVL, "5")
    field(FVST, "RTD")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }

record(mbbo, "$(device):CH$(channel):LIMITMODESET")
    {
    field(DESC, "Limit Mode Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol limitmode_set($(channel)) $(port)")
    field(ZRVL, "0")
    field(ZRST, "SLEEP")
    field(ONVL, "1")
    field(ONST, "LIMIT")
    field(TWVL, "2")
    field(TWST, "BAND")
    field(THVL, "3")
    field(THST, "MLIMIT")
    field(FRVL, "4")
    field(FRST, "MBAND")
    field(FVVL, "5")
    field(FVST, "RTD")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "2 second")
    }
    
record(ao, "$(device):CH$(channel):UPPERLIMITSET")
    {
    field(DESC, "Upper Limit Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol upperlimit_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):UPPERLIMIT")
    {
    field(DESC, "Upper Limit")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol upperlimit($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }

record(ao, "$(device):CH$(channel):LOWERLIMITSET")
    {
    field(DESC, "Lower Limit Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol lowerlimit_set($(channel)) $(port)")
    }

record(ai, "$(device):CH$(channel):LOWERLIMIT")
    {
    field(DESC, "Lower Limit")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol lowerlimit($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }
    
record(stringout, "$(device):CH$(channel):FORMULARELAYSET")
    {
    field(DESC, "Formula Relay Set")
    field(DTYP, "stream")
    field(OUT,  "@pr4000.protocol formularelay_set($(channel)) $(port)")
    }

record(stringin, "$(device):CH$(channel):FORMULARELAY")
    {
    field(DESC, "Formula Relay")
    field(DTYP, "stream")
    field(INP,  "@pr4000.protocol formularelay($(channel)) $(port)")
    field(SDIS, "$(device):CH$(channel):DISA")
    field(SCAN, "5 second")
    }
    
    
##
## Try to work around mbbi limitation of 16 enums
## as we need 21 for range units.
##
record(mbbo, "$(device):CH$(channel):UNITSLISTA")
    {
    field(DESC, "First 16 available units")
    field(DTYP, "Raw Soft Channel")
    field(ZRVL, "0")
    field(ZRST, "uBar")
    field(ONVL, "1")
    field(ONST, "mBar")
    field(TWVL, "2")
    field(TWST, "Bar")
    field(THVL, "3")
    field(THST, "mTor")
    field(FRVL, "4")
    field(FRST, "Torr")
    field(FVVL, "5")
    field(FVST, "kTor")
    field(SXVL, "6")
    field(SXST, "Pa")
    field(SVVL, "7")
    field(SVST, "kPa")
    field(EIVL, "8")
    field(EIST, "mH2O")
    field(NIVL, "9")
    field(NIST, "cH2O")
    field(TEVL, "10")
    field(TEST, "PSI")
    field(ELVL, "11")
    field(ELST, "N/qm")
    field(TVVL, "12")
    field(TVST, "SCCM")
    field(TTVL, "13")
    field(TTST, "SLM")
    field(FTVL, "14")
    field(FTST, "SCM")
    field(FFVL, "15")
    field(FFST, "SCFH")
    field(DOL, "1")
    field(PINI, "YES")
    field(PHAS, "2")
    field(OUT,  "$(device):CH$(channel):RANGEUNITSSET")
    field(FLNK, "$(device):CH$(channel):RANGEUNITSSET")
    }
record(mbbo, "$(device):CH$(channel):UNITSLISTB")
    {
    field(DESC, "Last 4 available units")
    field(DTYP, "Raw Soft Channel")
    field(ZRVL, "16")
    field(ZRST, "SCFM")
    field(ONVL, "17")
    field(ONST, "mA")
    field(TWVL, "18")
    field(TWST, "V")
    field(THVL, "19")
    field(THST, "%")
    field(FRVL, "20")
    field(FRST, "C")
    field(DOL, "0")
    field(PINI, "YES")
    field(PHAS, "1")
    field(OUT,  "$(device):CH$(channel):RANGEUNITSSET")
    field(FLNK, "$(device):CH$(channel):RANGEUNITSSET")
    }


## Next three records not currently used...
##
record(ai, "$(device):CH$(channel):UNITSINDEX")
    {
    field(DESC, "Units index number 0..20")
    field(DTYP, "Soft Channel")
    field(INP,  "0")
    field(PINI, "YES")
    field(SCAN, "1 second")
    }
    
record(calc, "$(device):CH$(channel):UNITSSELN") 
    {
    field(DESC, "Units list SELN calc")
    field(INPA, "$(device):CH$(channel):UNITSINDEX")
    field(CALC, "(A>15)?1:0")
    field(FLNK, "$(device):CH$(channel):UNITSSEL")
    }

 record(sel, "$(device):CH$(channel):UNITSSEL")
    {
    field(DESC, "Select Units List")
    field(SELM, "Specified")
    field(SELN, "0")
    field(NVL,  "$(device):CH$(channel):UNITSSELN")
    field(INPA, "$(device):CH$(channel):UNITSLISTA.RVAL")
    field(INPB, "$(device):CH$(channel):UNITSLISTB.RVAL")
    }
    
